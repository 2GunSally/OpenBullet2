@using RuriLib.Models.Variables
@inject Microsoft.Extensions.Localization.IStringLocalizer<Debugger> Loc

<div class="container-fluid my-3">
    <div class="row">
        <div class="list-group list-group-horizontal mb-3">
            @if (!isRunning)
            {
                <button class="btn btn-sm btn-outline-success" @onclick="Run"><span class="oi oi-media-play"></span> @Loc["Start"]</button>
            }
            else
            {
                <button class="btn btn-sm btn-outline-danger" @onclick="Stop"><span class="oi oi-media-stop"></span> @Loc["Stop"]</button>
            }
        </div>
    </div>
    <div class="row">
        <div class="col-lg-8 col-12 pr-lg-2 px-0">
            <BotLoggerViewer BotLogger="logger" @ref="loggerViewer" />
        </div>
        <div class="col-lg-4 col-12 pl-lg-2 px-0 mt-3 mt-lg-0">
            <EditForm Model="options">
                <label>@Loc["TestData"]</label>
                <InputText @bind-Value="options.TestData" />
                <label class="mt-3">@Loc["WordlistType"]</label>
                <InputSelect @bind-Value="options.WordlistType">
                    @foreach (var name in RuriLibSettings.Environment.WordlistTypes.Select(w => w.Name))
                    {
                        <option value="@name">@name</option>
                    }
                </InputSelect>
                <br />
                <label class="mt-3">@Loc["UseProxy"]</label>
                <InputCheckbox @bind-Value="options.UseProxy" />
                <br />
                <label class="mt-3">@Loc["TestProxy"]</label>
                <InputText @bind-Value="options.TestProxy" />
                <label class="mt-3">@Loc["Type"]</label>
                <InputSelect @bind-Value="options.ProxyType">
                    @foreach (var name in Enum.GetNames(typeof(RuriLib.Models.Proxies.ProxyType)))
                    {
                        <option value="@name">@name</option>
                    }
                </InputSelect>
                <br />
                <label style="margin-top: 15px;">@Loc["PersistLog"]</label>
                <InputCheckbox @bind-Value="options.PersistLog" />
                <br />
            </EditForm>

            <br />
            <h5>@Loc["Variables"]</h5>
            <RadzenTree Style="width: 100% !important; height: 300px; cursor: default;">
                @foreach (var variable in options.Variables)
                {
                    <RadzenTreeItem Text="@($"{variable.Name} ({variable.Type}){(variable.MarkedForCapture ? " [CAPTURED]" : "")}")">
                        @switch (variable)
                        {
                            default:
                                <RadzenTreeItem Text="@variable.AsString()" />
                                break;

                            case ListOfStringsVariable _:
                                @foreach (var element in variable.AsListOfStrings())
                                {
                                    <RadzenTreeItem Text="@element" />
                                }
                                break;

                            case DictionaryOfStringsVariable _:
                                @foreach (var element in variable.AsDictionaryOfStrings())
                                {
                                    <RadzenTreeItem Text="@($"{element.Key}: {element.Value}")" />
                                }
                                break;

                            case ByteArrayVariable _:
                                <RadzenTreeItem Text="@(Convert.ToBase64String(variable.AsByteArray()))" />
                                break;
                        }
                    </RadzenTreeItem>
                }
            </RadzenTree>
        </div>
    </div>
</div>

@code {
    private bool isRunning = false;
}