<InputText class="bg-variable"
       @onfocus="ShowSuggestions"
       @onfocusout="HideSuggestions"
       Value="@currentValue"
       ValueExpression="() => currentValue"
       ValueChanged="e => OnValueChanged(e)"/>
<div class="suggestions-container @(showSuggestions ? "visible" : "invisible")">
    <div class="input-suggestions">
        @foreach (var option in Suggestions)
        {
            <div class="suggestion-item" @onclick="() => SetVariable(option)">
                @option
            </div>
        }
    </div>
</div>

@code {
    [Parameter] public IEnumerable<string> Suggestions { get; set; }
    [Parameter] public string Value
    {
        get => currentValue;
        set
        {
            currentValue = value;
        }
    }
    [Parameter] public EventCallback<string> ValueChanged { get; set; }
    private string currentValue;
    private bool showSuggestions = false;

    private void ShowSuggestions()
    {
        showSuggestions = true;
        StateHasChanged();
    }

    private async Task HideSuggestions()
    {
        // Needed because otherwise onfocusout wins over onclick
        await Task.Delay(100);

        if (showSuggestions)
        {
            showSuggestions = false;
            StateHasChanged();
        }
    }

    private Task SetVariable(string value)
    {
        currentValue = value;
        showSuggestions = false;
        StateHasChanged();
        return ValueChanged.InvokeAsync(value);
    }

    private Task OnValueChanged(string newValue)
    {
        currentValue = newValue;
        return ValueChanged.InvokeAsync(newValue);
    }
}
